---
sidebar_label: Rma Example
---
# Rma Example

import {rma, each} from 'use-midi/src'

export default function () {
    const [i, setI] = React.useState('not-selected')
    const [o, setO] = React.useState('not-selected')
    const [data, setData] = React.useState([0, 0, 0])
    const [is, setIs] = React.useState([])
    const [os, setOs] = React.useState([])
    const [log, setLog] = React.useState([])
    React.useEffect(() => {
        setLog(p => [...p, `run effect`])
        rma(() => {
            setLog(p => [...p, `run rma`])
            const inputs = [...rma.inputs.keys()]
            const outputs = [...rma.outputs.keys()]
            void (setIs(inputs), setOs(outputs))
            void (setI(inputs[0]), setO(outputs[0]))
            return true
        })
    }, [])
    const handleClick = () => {
        setLog(p => [...p, `clicked`])
        const input = rma.inputs.get(i)
        const output = rma.outputs.get(o)
        console.log(input, output)
        input.onmidimessage = e => {
            output.send(e.data)
            setLog(p => [...p, "onmidimessage " + e.data])
        }
    }
    const handleChange = (index=0) => e => {
        setData(p => p.map((v, k) => k===index? e.target.value: v))
    }
    return (
        <div>
          <p>input: {i}</p>
          {React.useMemo(() => {
            const target = rma.inputs?.get(i)
            return target && (
              <ul>
                <li>name: {target.name}</li>
                <li>type: {target.type}</li>
                <li>state: {target.state}</li>
              </ul>
            )
          }, [i])}
          <p>output: {o}</p>
          {React.useMemo(() => {
            const target = rma.outputs?.get(o)
            return target &&  (
              <ul>
                <li>name: {target.name}</li>
                <li>type: {target.type}</li>
                <li>state: {target.state}</li>
              </ul>
            )
        }, [o])}
          <select value={i} onChange={e => setI(e.target.value)}>
            <option value="not-selected">Please select a input device</option>
            {is?.map(key => <option key={key} value={key}>{key.slice(0, 25)}...</option>)}
          </select>
          <select value={o} onChange={e => setO(e.target.value)}>
            <option value="not-selected">Please select a output device</option>
            {os?.map(key => <option key={key} value={key}>{key.slice(0, 25)}...</option>)}
          </select>
          <div>
            <input type="number" min="0" max="255" value={data[0]} onChange={handleChange(0)}/>
            <input type="number" min="0" max="255" value={data[1]} onChange={handleChange(1)}/>
            <input type="number" min="0" max="255" value={data[2]} onChange={handleChange(2)}/>
            <button onClick={handleClick}>send data</button>
          </div>
          <ul>
            {log.map((l, key) => <li key={key}>{l}</li>)}
          </ul>
        </div>
    )
}
